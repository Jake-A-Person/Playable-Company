je_pc_update_modifers = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	group = je_group_internal_affairs

	possible = {
		this = c:PCM
	}


	on_weekly_pulse = {
		effect = {
			c:GBR = {
				every_scope_building = {
					limit = {
						# is_building_type = building_company_headquarter
						#has_modifier = goods_input_gold_add		
						is_building_group = bg_company_headquarter 
						not = {
							is_building_group = bg_company_regional_headquarter
						}		
					}
					
					root = {
						set_variable = {
							name = pc_share_payout_var
							value = prev.weekly_profit
						}
						change_variable = {
							name = pc_share_payout_var
							divide = 10
						}
						set_variable = {
							name = pc_share_payout_mod_mult_var
							value = var:pc_share_payout_var
						}
						change_variable = {
							name = pc_share_payout_mod_mult_var
							divide = prev.level
						}
						add_modifier = {
							name = pc_comp_hq_gain_share_mult
							multiplier = var:pc_share_payout_var
							days = 6
						}
					}
					add_modifier = {
						name = pc_comp_hq_owe_share_mult
						multiplier = root.var:pc_share_payout_mod_mult_var
						days = 6
					}
				}

				every_company = {
					# bg:bg_company_headquarter = {
						
					# }
					# add_modifier = {
					# 	name = pc_comp_hq_owe_share_mult
					# 	multiplier = 1000
					# 	days = 6
					# }
					set_variable = var_stufffff
					# root = {
					# 	add_modifier = {
					# 		name = pc_comp_hq_gain_share_mult
					# 		multiplier = 1000
					# 		days = 6
					# 	}
					# }
				}
			}
			add_modifier = {
				name = pc_comp_hq_gain_share_mult
				multiplier = 1000
				days = 6
			}

			#update the number of corp admin buildings
			every_state = {
				limit = {
					or = {
						has_building = building_pc_corp_fake_administration
						has_building = building_pc_corp_administration
					}
				}
				if = {
					limit = {
						not = {
							has_building = building_pc_corp_fake_administration
						}
					}
					remove_building = building_pc_corp_administration
				}
				if = {
					limit = {
						not = {
							has_building = building_pc_corp_administration
						}
					}
					create_building = {
						building = building_pc_corp_administration
						level = b:building_pc_corp_fake_administration.level
					}
				}
				else = {
					if = {
						#more fake levels then real levels then bring the number of real levels up to the number of fake levels
						limit = {
							b:building_pc_corp_fake_administration.level > b:building_pc_corp_administration.level
						}
						#will just add the number of levels needed
						create_building = {
							building = building_pc_corp_administration
							level = b:building_pc_corp_fake_administration.level
						}
					}
					else_if = {
						#more real levels then fake levels then bring the number of real levels down to the number of fake levels
						limit = {
							b:building_pc_corp_fake_administration.level < b:building_pc_corp_administration.level
						}
						#remove all levels as create_building will only add levels not remove them
						remove_building = building_pc_corp_administration
						#will add the number of levels needed but wont remove any existing level (is a lang limitation)
						create_building = {
							building = building_pc_corp_administration
							level = b:building_pc_corp_fake_administration.level
						}
					}
					# else b:building_pc_corp_fake_administration.level = b:building_pc_corp_administration.level so no change in the levels so do nothing
				}
			}
			#update the number of corp construction buildings
			every_state = {
				limit = {
					or = {
						has_building = building_pc_corp_fake_construction_sector
						has_building = building_pc_corp_construction_sector
					}
				}
				if = {
					limit = {
						not = {
							has_building = building_pc_corp_fake_construction_sector
						}
					}
					remove_building = building_pc_corp_construction_sector
				}
				if = {
					limit = {
						not = {
							has_building = building_pc_corp_construction_sector
						}
					}
					create_building = {
						building = building_pc_corp_construction_sector
						level = b:building_pc_corp_fake_construction_sector.level
					}
				}
				else = {
					if = {
						#more fake levels then real levels then bring the number of real levels up to the number of fake levels
						limit = {
							b:building_pc_corp_fake_construction_sector.level > b:building_pc_corp_construction_sector.level
						}
						#will just add the number of levels needed
						create_building = {
							building = building_pc_corp_construction_sector
							level = b:building_pc_corp_fake_construction_sector.level
						}
					}
					else_if = {
						#more real levels then fake levels then bring the number of real levels down to the number of fake levels
						limit = {
							b:building_pc_corp_fake_construction_sector.level < b:building_pc_corp_construction_sector.level
						}
						#remove all levels as create_building will only add levels not remove them
						remove_building = building_pc_corp_construction_sector
						#will add the number of levels needed but wont remove any existing level (is a lang limitation)
						create_building = {
							building = building_pc_corp_construction_sector
							level = b:building_pc_corp_fake_construction_sector.level
						}
					}
					# else b:building_pc_corp_fake_construction_sector.level = b:building_pc_corp_construction_sector.level so no change in the levels so do nothing
				}
			}

		}
	}

	on_monthly_pulse = {
		effect = {
			set_variable = {
				name = pc_num_corp_admin_var
				value = 0
			}
			set_variable = {
				name = pc_corp_construction_var
				value = 0
			}
			every_country = {
				#resets the var at the root for each country
				#var is at root so can use prev scope
				ROOT = {
					set_variable = {
						name = pc_corp_building_cost_var
						value = 0
					}
				}
				limit = {
					not = {
						is_country_type = decentralized
					}
				}
				every_scope_building = {
					limit = {
						or = {
							levels_owned_by_country = {
								target = root
								value > 0
							}
							is_building_type = building_pc_corp_administration
							is_building_type = building_pc_corp_construction_sector
						}
					}
					if = {
						limit = {
							is_building_type = building_pc_corp_administration
						}
						ROOT = {
							change_variable = {
								name = pc_num_corp_admin_var
								add = prev.level
							}
						}
						#cant use prev and set var per conutry as putting
						#a prev in a prev wont give the building scope
						ROOT = {
							change_variable = {
								name = pc_corp_building_cost_var
								add = prev.weekly_profit
							}
						}
					}
					else_if = {
						limit = {
							is_building_type = building_pc_corp_construction_sector
						}
						root = {
							set_variable = {
								name = pc_corp_num_construction_var
								value = prev.level
							}
						}
						root = {
							change_variable = {
								name = pc_corp_building_cost_var
								add = prev.weekly_profit
							}

						}
						if = {
							limit = { has_active_production_method = pm_pc_corp_wooden_buildings }
							ROOT = {
								change_variable = {
									name = pc_corp_num_construction_var
									multiply = 2
								}
							}
						}
						else_if = {
							limit = { has_active_production_method = pm_pc_corp_iron_frame_buildings }
							ROOT = {
								change_variable = {
									name = pc_corp_num_construction_var
									multiply = 5
								}
							}
						}
						else_if = {
							limit = { has_active_production_method = pm_pc_corp_steel_frame_buildings }
							ROOT = {
								change_variable = {
									name = pc_corp_num_construction_var
									multiply = 10
								}
							}
						}
						else_if = {
							limit = { has_active_production_method = pm_pc_corp_arc_welded_buildings }
							ROOT = {
								change_variable = {
									name = pc_corp_num_construction_var
									multiply = 15
								}
							}
						}
						root = {
							change_variable = {
								name = pc_corp_construction_var
								add = var:pc_corp_num_construction_var
							}
						}
					}
					else = {
						if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_iron_var
								}
								is_building_type = building_iron_mine
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_coal_var
								}
								is_building_type = building_coal_mine
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_coffe_var
								}
								is_building_type = building_coffee_plantation
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_tea_var
								}
								is_building_type = building_tea_plantation
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_rubber_var
								}
								is_building_type = building_rubber_plantation
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_logging_var
								}
								is_building_type = building_logging_camp
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_opium_var
								}
								is_building_type = building_opium_plantation
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_food_var
								}
								is_building_type = building_food_industry
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_tooling_var
								}
								is_building_type = building_tooling_workshop
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_textile_var
								}
								is_building_type = building_textile_mill
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_oil_var
								}
								is_building_type = building_oil_rig
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_steel_var
								}
								is_building_type = building_steel_mill
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
						else_if = {
							limit = {
								root = {
									has_variable = pc_corp_building_spec_trade_var
								}
								is_building_type = building_trade_center
							}
							add_modifier = {
								name = pc_corp_build_throughput
								days = 30
							}
						}
					}
				}
				#if this country has corp buildings
				#then create a modifer to offset the cost
				if = {
					limit = {
						not = {
							root.var:pc_corp_building_cost_var = 0
						}
					}
					add_modifier = {
						name = pc_corp_building_cost_offset
						#pc_corp_building_cost_offset is -1 
						#pc_corp_building_cost_var is -ve (pc_corp_building_cost_var < 0)
						#so the effect witll be +ve (effect > 0)
						multiplier = root.var:pc_corp_building_cost_var
						days = 30
					}
					root = {
						add_modifier = {
							name = pc_corp_building_cost
							#pc_corp_building_cost_offset is -1 
							#pc_corp_building_cost_var is -ve (pc_corp_building_cost_var < 0)
							#so the effect will be +ve (effect > 0)
							multiplier = var:pc_corp_building_cost_var
							days = 30
						}
					}
				}

			}
			change_variable = {
				name = pc_num_corp_admin_var
				#how much bureaucracy (how many builing you can own) with 1 corporate admin building
				multiply = 20
			}
			add_modifier = {
				name = pc_corp_admin_bureau
				multiplier = var:pc_num_corp_admin_var
				#update each month so it auto clears
				#30 days so there isn't any overlap
				days = 30
			}
			add_modifier = {
				name = pc_corp_construction
				multiplier = var:pc_corp_construction_var
				#update each month so it auto clears
				days = 30
			}
		}
	}

	weight = 100
	should_be_pinned_by_default = yes
}